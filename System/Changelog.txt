Changelog:
- Optimized code
- Removed some duplicate functions
- Code cleanup